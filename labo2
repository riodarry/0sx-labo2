//2409626

unsigned long currentTime = 0;
int pinBouton = 2;
int pinLeds[] = {8, 9, 10, 11};
int pinPotentiometre = A0;
int nbreLeds = 4;
int mapmin = 0;
int mapmax = 1023;
int map2 = 20;
int max=20;
int cal =5;
int val2=15;
int val1=10;
int val0=5;

void setup() {
  Serial.begin(9600);
  pinMode(pinBouton, INPUT_PULLUP);
  for (int i = 0; i < nbreLeds; i++) {
    pinMode(pinLeds[i], OUTPUT);
  }
}

void loop() {
  currentTime = millis();
  int valeur = lirevalpotentiometre();
  allumerleds(valeur);
  clic();
}

int lirevalpotentiometre() {
  int valeurPotentiometre = analogRead(pinPotentiometre);
  return map(valeurPotentiometre, mapmin, mapmax, mapmin, map2);
}

void allumerleds(int valeur) {
  
  int indexLed = 0;

  if (valeur < val0) {
    indexLed = 0;
  }
  else if (valeur < val1) {
    indexLed = 1;
  }
  else if (valeur < val2) {
    indexLed = 2;
  }
  else {
    indexLed = 3;
  }

  for (int i = 0; i < nbreLeds; i++) {
    digitalWrite(pinLeds[i], LOW);
  }

  digitalWrite(pinLeds[indexLed], HIGH);
}


void clic() {  
  static int etatPrecedent = HIGH;
  static unsigned long dernierChangement = 0;
  const int delai = 50;

  int etatBouton = digitalRead(pinBouton);

  if (etatBouton != etatPrecedent) { 
    dernierChangement = millis();
  }

  if ((millis() - dernierChangement) > delai && etatBouton == LOW) {
    etatPrecedent = etatBouton;
    int valeur = analogRead(pinPotentiometre);
    afficherProgression(valeur);
    while (digitalRead(pinBouton) == LOW) {
    }
    etatPrecedent = HIGH;
  } else {
    etatPrecedent = etatBouton;
  }
}

void afficherProgression(int valeurPotentiometre) {
  int pourcentage = map(valeurPotentiometre, mapmin, mapmax, 0, 100);
  Serial.print("[");
  for (int i = 0; i < max; i++) {
    if (i < pourcentage / cal) {  
      Serial.print("#");
    } else {
      Serial.print(".");
    }
  }
  Serial.print("] ");
  Serial.print(pourcentage);
  Serial.println("%");
}
